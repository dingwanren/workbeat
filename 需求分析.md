# Git仓库工作节奏分析工具需求文档

## 1. 项目概述

### 1.1 项目目标
开发一个零安装的CLI工具，通过分析Git仓库提交历史，可视化展示团队成员的工作模式、代码贡献度和项目节奏。

### 1.2 核心价值
- **个人维度分析**：聚焦每个开发者的工作模式和代码质量
- **多仓库聚合**：支持分析多个相关仓库，全面了解团队工作状态
- **零安装使用**：通过npx直接运行，降低使用门槛

## 2. 功能需求

### 2.1 核心功能模块

#### A. 数据收集模块
```javascript
// 收集的原始数据字段
{
  author: { name: string, email: string },
  timestamp: Date,
  insertions: number,
  deletions: number, 
  filesChanged: number,
  commitHash: string,
  message: string,
  repository: string
}
```

#### B. 个人维度分析指标
**基础指标：**
- 提交次数统计
- 代码变更量（增/删/净增行数）
- 活跃文件数量

**工作模式识别：**
- 提交时间分布（工作日/周末，工作时间/非工作时间）
- 提交频率模式（集中提交 vs 持续提交）
- 单次提交规模分布

**代码质量维度：**
- 平均每次提交变更行数
- 大提交（超过阈值）比例
- 提交注释质量评分

#### C. 多仓库支持
- 支持指定多个本地仓库路径
- 支持通过配置文件批量管理仓库列表
- 数据聚合时区分仓库来源

#### D. 可视化展示
- 本地启动Web服务展示图表
- 响应式设计，支持不同设备查看

### 2.2 用户使用流程
```bash
# 单仓库分析
npx git-rhythm-analyzer /path/to/repo

# 多仓库分析  
npx git-rhythm-analyzer --repos repo1,repo2,repo3

# 使用配置文件
npx git-rhythm-analyzer --config ./analysis-config.json
```

## 3. 详细功能规格

### 3.1 CLI参数设计
```bash
# 基本用法
npx git-rhythm-analyzer [仓库路径]

# 选项参数
--repos,-r       # 多仓库路径（逗号分隔）
--config,-c      # 配置文件路径
--since,-s       # 分析起始时间
--until,-u       # 分析结束时间  
--output,-o      # 输出目录
--port,-p        # 可视化服务端口
```

### 3.2 配置文件格式
```json
{
  "repositories": [
    "/path/to/repo1",
    "/path/to/repo2"
  ],
  "timeRange": {
    "since": "2024-01-01",
    "until": "2024-12-31"
  },
  "authors": {
    "include": ["user1@email.com", "user2@email.com"],
    "exclude": ["bot@email.com"]
  },
  "analysis": {
    "workHours": {"start": 9, "end": 18},
    "largeCommitThreshold": 500
  }
}
```

### 3.3 可视化图表类型

#### 个人工作模式面板
- **提交时间热力图**：展示一周内各时段的提交活跃度
- **提交规模分布图**：显示大/中/小提交的比例
- **活跃趋势图**：按时间展示提交频率和代码量变化
- **工作效率图表**：工作时间 vs 非工作时间贡献对比

#### 团队对比视图
- 成员贡献度雷达图
- 工作模式聚类分析
- 代码质量指标对比

## 4. 技术架构建议

### 4.1 技术栈选择
- **CLI框架**: Commander.js
- **Git操作**: simple-git
- **可视化**: Chart.js 或 ECharts
- **Web服务**: Express + 静态页面
- **数据处理**: 原生JavaScript数组方法

### 4.2 项目结构
```
git-rhythm-analyzer/
├── bin/                    # CLI入口
├── src/
│   ├── core/              # 核心逻辑
│   │   ├── git-parser.js     # Git数据解析
│   │   ├── analyzer.js       # 数据分析
│   │   └── aggregator.js     # 多仓库聚合
│   ├── metrics/           # 指标计算
│   │   ├── work-pattern.js   # 工作模式分析
│   │   ├── code-quality.js   # 代码质量分析
│   │   └── contribution.js   # 贡献度分析
│   ├── visualizer/        # 可视化
│   │   ├── data-exporter.js  # 数据导出器
│   │   └── web-ui/           # Vue前端应用
│   └── utils/             # 工具函数
└── package.json
```

## 5. 数据指标定义

### 5.1 工作模式指标
```javascript
const workPatternMetrics = {
  // 时间分布
  workHourRatio: '工作时间提交比例',
  weekendRatio: '周末提交比例',
  
  // 提交模式  
  commitFrequency: '日均提交次数',
  commitRegularity: '提交规律性评分',
  
  // 规模模式
  largeCommitRatio: '大提交比例',
  avgCommitSize: '平均提交规模'
}
```

### 5.2 代码质量指标
```javascript
const codeQualityMetrics = {
  changeEfficiency: '变更效率', // 有效代码净增量
  stability: '代码稳定性',      // 删除/新增比例
  focus: '工作专注度'           // 单次提交文件集中度
}
```

## 6. 扩展性考虑

### 6.1 短期扩展
- 导出分析报告（PDF/JSON）
- 自定义指标配置
- 团队基准对比

### 6.2 长期扩展
- GitLab/GitHub API集成
- 实时监控模式
- 预测性分析
- 插件系统

## 7. 非功能性需求

- **性能**: 万级别提交记录应在30秒内完成分析
- **兼容性**: 支持主流Git版本
- **安全性**: 纯本地分析，数据不上传
- **易用性**: 零配置启动，智能默认值

## 8. 实施建议

### Phase 1: MVP版本
1. 单仓库基础分析
2. 核心指标计算
3. 基础可视化

### Phase 2: 功能完善
1. 多仓库支持
2. 工作模式识别
3. 增强可视化

### Phase 3: 高级功能
1. 代码质量深度分析
2. 团队对比功能
3. 报告导出
